<!doctype html>
<html>
	<head>
		<script src="http://cdn.alloyui.com/2.0.0/aui/aui-min.js"></script>
		<link href="http://cdn.alloyui.com/2.0.0/aui-css/css/bootstrap.min.css" rel="stylesheet"></link>
		
		<script src="file.json" name="obj"></script>
	</head>

	<body>
		<p>This page requires Javascript to be viewed correctly.</p>
		<div>
			<div id="pagination" class="pagination pagination-centered">
				<ul class="pagination-content">
					<li><a href="#">Prev</a></li>

					<li><a href="#">Next</a></li>
				</ul>
			</div>
			<div id="todos" class="content">

			</div>
		</div>
	</body>

	<script>
	"use strict";
	YUI().use(
		'aui-node',
		'aui-pagination',
		'aui-button',
		'aui-sortable-layout',
		'aui-sortable-list',
		'dd-constrain',
		function(Y) {
			var notice = Y.one('body p');
			notice.setStyle('display','none');

			// Populate content from file.json
			for (var i = 1; obj.questions[i]; i++) {
				var startdiv = Y.one('#todos');
				var adddiv = Y.Node.create('<div />');
				var addh3 = Y.Node.create('<h3 />');
				addh3.setHTML(obj.questions[i].title);
				adddiv.set('id','page'+i);
				adddiv.setStyle('display','none');
				adddiv.setHTML(addh3);
				startdiv.appendChild(adddiv);

				if (obj.questions[i].type === 'rearrangeList') {
					var startul = Y.Node.create('<ul />');
					for (var j = 0; obj.questions[i].data[j]; j++) {
						var addli = Y.Node.create('<li />');
						addli.set('id',j+1);
						addli.setHTML(obj.questions[i].data[j]);
						startul.appendChild(addli);
					}
					adddiv.appendChild(startul);

					var btn = Y.Node.create('<input />');
					btn.setAttribute('class','btn');
					btn.setAttrs(
						{
							'id': obj.questions[i].key,
							'type': 'submit',
							'value': 'Check!'
						}
					);
					adddiv.appendChild(btn);
					var dnd = startul.ancestor('div');
					dnd.setAttribute('class', 'dnd');
				}
				if (obj.questions[i].type === 'rearrangeBlock') {
					var startddiv = Y.Node.create('<div />');
					startddiv.setAttribute('class', 'columnsections '+'yui3-g');
					for (var j = 1; obj.questions[i].data[j]; j++) {
						var colbound = Y.Node.create('<div />');
						colbound.setAttribute('class', 'colbound ' + 'column ' +"yui3-u-1-3");
						colbound.setHTML('Column '+j);
						for (var k = 0; obj.questions[i].data[j][k]; k++) {
							var addli = Y.Node.create('<li />');
							addli.setAttribute('class', 'portlet');
							addli.setHTML(obj.questions[i].data[j][k]);
							colbound.appendChild(addli);
						}
						startddiv.appendChild(colbound);
					}
					adddiv.appendChild(startddiv);
				}
				if (obj.questions[i].type === 'trueFalse') {
					var startol = Y.Node.create('<ol />');
					for (var j = 0; obj.questions[i].data[j]; j++) {
						var addli = Y.Node.create('<li />');
						addli.setHTML(obj.questions[i].data[j]);

						var btn = Y.Node.create('<input />');
						btn.setAttribute('class','btn ');
						btn.setAttrs(
							{
								'name': j+1,
								'value': 'Select',
								'type': 'checkbox'
							}
						);
						startol.appendChild(addli);
						startol.appendChild(btn);
					}
					adddiv.appendChild(startol);
					var tof = startol.ancestor('div');
					tof.setAttribute('class','tof');
				}

			}

			//Pagination
			var gen = Y.all('.content > div');
			var contentcount = null;
			contentcount = gen.getDOMNodes().length;
			var startgen = Y.one('.pagination-content li');

			for (var i = contentcount; i > 0; i--) {
				var p = Y.Node.create('<li />');
				var q = Y.Node.create('<a />');
				q.set('href', '#');
				q.setHTML(Number(i));
				p.setHTML(q);
				startgen.placeAfter(p);
			}

			var pages = Y.all('.content > div');

			new Y.Pagination(
				{
					boundingBox: '#pagination',
					circular: false,
					contentBox: '#pagination .pagination-content',
					on: {
						changeRequest: function(event) {
							var instance = this,
							state = event.state,
							lastState = event.lastState;

							if (lastState) {
								pages.item(lastState.page - 1).setStyle('display', 'none');
							}
							pages.item(state.page - 1).setStyle('display', 'block');
						}
					},
					page: 1
				}
			).render();

			//Sortable Layout
			var proxyNode = Y.Node.create('<div class="sortable-layout-proxy"></div>');
			var DDM = Y.DD.DDM;

			var sortableLayout = new Y.SortableLayout(
				{
					dragNodes: '.portlet',
					dropContainer: '.columnsections',
					proxyNode: proxyNode
				}
			);

			//Make lists sortable
			new Y.SortableList(
				{
					dropCondition: function(event) {
						return true;
					},
					dropOn: '.content',
					nodes: '.content .dnd li'
				}
			);

			//List order checking
			var nodednd = Y.all('.dnd .btn');
			nodednd.on(
				'click',
				function(e) {
					var clicked = e.currentTarget;
					var key = clicked.getAttribute('id');
					var lis = clicked.ancestor('div');
					lis = lis.getElementsByTagName('li');
					var strlis = lis.getAttribute('id').toString();

					if (key == strlis) {
						lis.setStyles(
							{
								backgroundColor: 'lightBlue',
								color: 'green'
							}
						);
					}

					else {
						lis.setStyles(
							{
								backgroundColor: 'lightYellow',
								color: 'red'
							}
						);
					}
				}
			);
		}
	);
	</script>
</html>